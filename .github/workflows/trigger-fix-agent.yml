name: Trigger Fix Agent

on:
  # Manual trigger for sending an issue to the fix agent
  workflow_dispatch:
    inputs:
      issue_number:
        description: 'Issue number to mark for automated fixing'
        required: true
        type: number

  # Also runs when an issue is labeled, so the compiled agent workflow can react
  issues:
    types: [labeled]

jobs:
  # When run manually, just add the agent-fix label.
  add-fix-label:
    if: github.event_name == 'workflow_dispatch'
    runs-on: ubuntu-latest
    permissions:
      issues: write
      contents: read
    env:
      GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
    steps:
      - name: Add agent-fix label to issue
        run: |
          gh issue edit ${{ inputs.issue_number }} \
            --repo "$GITHUB_REPOSITORY" \
            --add-label "agent-fix"

  # On label events, this job is just a no-op marker; the real work
  # is performed by the gh-aw compiled workflow (agent-fix-issue.lock.yml).
  on-agent-fix-label:
    if: github.event_name == 'issues' && github.event.action == 'labeled' && github.event.label.name == 'agent-fix'
    runs-on: ubuntu-latest
    steps:
      - name: Note agentic workflow handoff
        run: echo "agent-fix label added; gh-aw agent-fix-issue workflow will process this issue."
